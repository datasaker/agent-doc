# dsk-log-agent

## Installing DataSaker Log agent in Kubernetes environment

A `Log agent` is an agent that collects, processes and transmits log data generated by systems or applications in near real time in various environments. It can be used to centrally manage and analyze log data generated by multiple servers through `Log agent`. As a result, users can quickly detect and respond to problems occurring in the system or applications. In addition, log data can be analyzed and used for various purposes such as security, performance, and business analysis. We tailor agent settings to your needs to deliver optimal results.

## Did you run the DataSaker predecessor?

If the preceding task of `DataSaker` has not been carried out in the current Kubernetes environment, please proceed with the preceding task of `DataSaker` first. [DataSaker predecessor](dsk-log-agent/en/$%7BPREPARATION\_MANUAL\_KR%7D/)

## Install Log agent

By default, the `Log agent` is deployed as a daemonset by default in a Kubernetes environment. Thus, a `Log agent` is installed on all nodes. If you want to install `Log agent` only on a specific node, additionally set affinity or nodeSelector for that node.

### 1. Log agent setting value registration

The meaning and default setting values ​​of `Log agent` are as follows. Different users have different requirements for agent setup. Therefore, the agent settings must be adjusted to suit the user's settings. Tune your agent settings for optimal results. Add or edit these values ​​in "\~/datasaker/config.yaml".

Following is a description of each setting item in the log agent configuration file.
```yaml
logAgent:
  logs:
    - service:
      tag: []
      keyword: []
      multiline:
        format:
        pattern: []
      masking:
        - pattern:
          replace:
      collect:
        type:
        category:
        address:
        file:
          paths: []
          exclude_paths: []
        kubernetes:
          - namespace:
            pod:
            container:
```
| **Settings** | **Description** | **Default** |
| ----------------------------------- | --------------------------------------------------------------------------------------- |:-----------------:|
| **logs** | Log collection target information | |
| `service` | Service name of the log collection destination | `default` |
| `tag` | Tag of log collection target | N/A |
| `keyword` | Log Collection Keywords (collects only logs containing keywords) | |
| **multiline** | Multi-line log collection settings | |
| `format` | multi-line log formats (eg go, java, ruby, python) | |
| `pattern` | Multi-line log pattern (e.g. ^\d{4}-\d{2}-\d{2}) - User custom regex pattern can be used | |
| **masking** | Sensitive information log masking settings | |
| `pattern` | Log pattern to mask (e.g. ^\d{4}-\d{2}-\d{2}) - user custom regex pattern available | |
| `replace` | The string where the masking pattern is to be replaced (eg ******) | |
| **collect** | Log Collection Target Settings | |
| `type` | log collection method (write one value among `file`, `driver`, `kubernetes`) | `file` |
| `category` | service classification (write a value of one of `app`, `database`, `syslog`, `etc`) | `etc` |
| `address` | Database host and port information (set when the service category is database) | |
| **file** | If the log collection method is file, set | |
| `paths` | Log collection destination path (e.g. /var/log/sample/*.log) | `/var/log/*.log` |
| `exclude_paths` | Log collection exclusion target path | |
| **kubernetes** | If the log collection method is kubernetes, Settings | |
| `namespace` | Log Collection Target Namespace | `*` |
| `pod` | Pod name for log collection | `*` |
| `container` | Log collection target container name | `*` |

In a Kubernetes environment, log agents can collect logs in two ways.

* **kubernetes** : Collects logs through the information of the workload to collect logs. Set the namespace, pod name, and container name of the workload to collect. (If you deploy your log agent as a Daemonset, use that method.)
* **file** : Collect the log file directly. Mount the logs to be collected directly on the log agent and set the relative path to the log file to be collected. (If you deploy the log agent as a sidecar pattern, use that method.)

For example, if you're collecting logs via Kubernetes workload information, you could write a configuration file like this:


```shell
cat << EOF >> ~/datasaker/config.yaml
logAgent:
  enabled: true
  logs:
    - collect:
        type: kubernetes
        kubernetes:
          - namespace: default
            pod: awesome-saker-5f4b7f7b4f-2q9qz
            container: awesome-saker
EOF
```
If you collect log files yourself, you can write a configuration file like this:
```shell
cat << EOF >> ~/datasaker/config.yaml
logAgent:
  enabled: true
  logs:
    - collect:
        type: file
        file:
          paths:
           - /var/log/awesome_saker/*.log
EOF
```
### 2. Log agent installation
```shell
helm upgrade datasaker datasaker/agent-helm -n datasaker -f ~/datasaker/config.yaml
```
