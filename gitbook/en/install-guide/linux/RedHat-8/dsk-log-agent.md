# dsk-log-agent

A `Log agent` is an agent that collects, processes and transmits log data generated by systems or applications in near real time in various environments. It can be used to centrally manage and analyze log data generated by multiple servers through `Log agent`. As a result, users can quickly detect and respond to problems occurring in the system or applications. In addition, log data can be analyzed and used for various purposes such as security, performance, and business analysis. We tailor agent settings to your needs to deliver optimal results.

## Did you run the DataSaker predecessor?

If the preceding task of `DataSaker` has not been carried out in the current RedHat 8 environment, please proceed with the preceding task of `DataSaker` first. [DataSaker predecessor](README.md)

## Install Log agent

### Install the fluent-bit package

`Log agent` collects logs through fluent-bit, so fluent-bit version 2.1.0 or higher must be installed when installing the agent.

Install fluent-bit 2.1.0 or higher using the following command.
```shell
curl https://raw.githubusercontent.com/fluent/fluent-bit/master/install.sh | sh
```
For details on installing the fluent-bit package, refer to the [official document](https://docs.fluentbit.io/manual/installation/linux/redhat-centos).

### 1. Install the package
```shell
sudo yum install dsk-log-agent
```
### 2. agent-config settings

Create agent-config file in `/etc/datasaker/dsk-log-agent/agent-config.yml` path.

For example, if you are collecting log files, you could write a configuration file like this:
```yaml
agent:
  logs:
    - collect:
        type: file
        file:
          paths:
            - '/var/log/sample/*.log'
```
> Caution: Set the log collection target path so that files other than log files are not set. Specify a file in the log collection path or exclude other files. Be sure to write the file extension format in log collection settings. (e.g. `.log`)

### 3. Run the package
```shell
systemctl enable dsk-log-agent --now
```
### 4. Check package execution status
```shell
systemctl status dsk-log-agent
```
## Remove Log agent

### 1. Abort the package
```shell
systemctl stop dsk-log-agent
```
### 2. Remove packages

Be sure to stop and remove the package before uninstalling it.
```shell
yum remove dsk-log-agent
```
## Set Log agent configuration

If you want to change log agent log collection settings, modify the configuration file in the `/etc/datasaker/dsk-log-agent/agent-config.yml` path.

Following is a description of each setting item in the log agent configuration file.
```yaml
agent:
  metadata:
    agent_name:
    cluster_id:
  logs:
    - service:
      tag: []
      keyword: []
      multiline:
        format:
        pattern: []
      masking:
        - pattern:
          replace:
      collect:
        type:
        category:
        address:
        file:
          paths: []
          exclude_paths: []
```
| **Settings** | **Description** | **Default** |
| ----------------------------------- | --------------------------------------------------------------------------------------- |:-----------------:|
| **metadata** | Agent basic information |
| `agent_name` | log agent name | `dsk-log-agent` |
| `cluster_id` | Cluster information of the environment to be controlled | `unknown` |
| **logs** | Log collection target information | |
| `service` | Service name of the log collection destination | `default` |
| `tag` | Tag of log collection target | N/A |
| `keyword` | Log Collection Keywords (collects only logs containing keywords) | |
| **multiline** | Multi-line log collection settings | |
| `format` | multi-line log formats (eg go, java, ruby, python) | |
| `pattern` | Multi-line log pattern (e.g. ^\d{4}-\d{2}-\d{2}) - User custom regex pattern can be used | |
| **masking** | Sensitive information log masking settings | |
| `pattern` | Log pattern to mask (e.g. ^\d{4}-\d{2}-\d{2}) - user custom regex pattern available | |
| `replace` | The string where the masking pattern is to be replaced (eg ******) | |
| **collect** | Log Collection Target Settings | |
| `type` | Log collection method (write one value among `file` or `driver`) | `file` |
| `category` | service classification (write a value of one of `app`, `database`, `syslog`, `etc`) | `etc` |
| `address` | Database host and port information (set when the service category is database) | |
| **file** | If the log collection method is file, set | |
| `paths` | Log collection destination path (e.g. /var/log/sample/*.log) | `/var/log/*.log` |
| `exclude_paths` | Log collection exclusion target path | |