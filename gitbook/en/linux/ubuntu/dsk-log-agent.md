# dsk-log-agent

A `Log agent` is an agent that collects, processes and transmits log data generated by systems or applications in near real time in various environments. It can be used to centrally manage and analyze log data generated by multiple servers through `Log agent`. As a result, users can quickly detect and respond to problems occurring in the system or applications. In addition, log data can be analyzed and used for various purposes such as security, performance, and business analysis. We tailor agent settings to your needs to deliver optimal results.

## Did you run the DataSaker predecessor?

In the current Ubuntu environment, if the preceding task of `DataSaker` has not been carried out, please proceed with the preceding task of `DataSaker` first. [DataSaker predecessor]($%7BPREPARATION\_MANUAL\_KR%7D/)

## Install Log agent

`Log agent` is currently supported only in Ubuntu 18.04.6 LTS (Bionic Beaver) environment.

### 1. Install the package

To install `Log agent` of `DataSaker`, sudo permission is required.

```shell
curl -fsSL -o installer.sh https://dsk-agent-s3.s3.ap-northeast-2.amazonaws.com/dsk-agent-s3/public/dsk-log-agent-install.sh
chmod 700 installer.sh
sudo ./installer.sh dsk-log-agent
```

### 2. agent-config settings

Create the agent-config file in the `/etc/datasaker/dsk-log-agent/agent-config.yml` path as follows.

```yaml
agent:
  metadata:
    agent_name: 'dsk-log-agent'
  collect:
    -paths:
      - '/var/log/sample/*.log'
      exclude_paths:
      - '/var/log/sample/private.log'
      keywords:
      - 'ERROR'
      tag: 'sample'
      service:
        name: 'sample service'
        category: 'database'
        type: 'postgres'
        address: '0.0.0.0:5432'
```

#### **\[caution]**

1. Be sure to enter one or more log collection paths (`path`). If the log collection path is not created, `Log agent` may not operate normally.
2. If you set to collect all logs in a specific path as follows, the log agent may be overloaded. (`/var/log/*`) It is recommended to create individual collection log files. (`/var/log/containers/sampleApp.log`)
3. Make sure that no files other than log files are set in the path. Specify a file in the log collection path or exclude other files. Be sure to fill in the format in log collection settings. (e.g. `.log`)

The description of each setting item in the log agent configuration file is as follows.

| **Settings** | **Description** | **Default** | **Necessary** |
| -------------------------------- | --------------------------------------------------------------------------------------- | :-------------: | :----------: |
| `agent.metadata.agent_name` | log agent name | `dsk-log-agent` | |
| `agent.collect.paths[]` | Log collection destination path (e.g. /var/log/sample/\*.log) | N/A | **✓** |
| `agent.collect.exclude_paths[]` | Log collection exclusion target path | N/A | |
| `agent.collect.keywords[]` | Log Collection Keywords (Only logs containing keywords are collected.) | N/A | |
| `agent.collect.tag` | custom tags | N/A | |
| `agent.collect.service.name` | service name | `default` | |
| `agent.collect.service.category` | Service category (write one of `app`, `database`, `syslog`, `etc` value) | `etc` | |
| `agent.collect.service.type` | Service database type and development language type (write one value among `postgres`, `mysql`, `java`, `etc`) | `etc` | |
| `agent.collect.service.address` | Database host and port information (Set when the service category is database. If not set, certain functions may not be available.) | N/A | ⚠️ |

### 3. Run the package

```shell
sudo systemctl enable dsk-log-agent --now
```

> Notice\
>
>
> * For log collection, you need to configure the agent configuration file before running the package (`global-config.yml`, `config.conf`).\
>
> * The log agent collects logs using `fluentd` by default. If you already have `fluentd` in use, you can change it by setting the `DSK_FLUENTD_CMD` environment variable. When running using environment variables, run as follows. (`sudo -E dsk-log-agent start`)

### 4. Check package execution status

```shell
systemctl status dsk-log-agent
```

or

```shell
service dsk-log-agent status
```

***

## Remove Log agent

### 1. Abort the package

```shell
systemctl stop dsk-log-agent
```

or

```shell
service dsk-log-agent stop
```

### 2. Remove packages

Be sure to stop and remove the package before uninstalling it.

```shell
sudo apt remove dsk-log-agent
```